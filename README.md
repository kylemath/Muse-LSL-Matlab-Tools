# Muse-LSL-Matlab-Tools
chadcwilliams.weebly.com/muse

<h2 class="wsite-content-title" style="text-align:left;">Muse LSL on Mac OS X</h2>

<div class="paragraph" style="text-align:left;"><br /><strong>This guide is set to teach you how to connect to the 2016 Muse Headband (http://www.choosemuse.com/&#8203;) using LSL (lab streaming layer) and to send markers with Matlab. If you are looking to connect to Muse using LSL but run experiments in Python, you only need the Muse LSL Tools package (thus, this tutorial is not what you are looking for).<br /><br />Please note: A lot of these tools are in development and are subject to change. Furthermore, I have developed the Muse LSL Matlab Tools package, but not the Muse LSL Tools (developed by Dr. Kyle Mathewson and his team - </strong><a href="http://kylemathewson.com/" target="_blank">http://kylemathewson.com/</a><strong>) or Lab Streaming Layer (developed by the team at Swartz Center for Computational Neuroscience, UCSD - </strong><a href="https://sccn.ucsd.edu/" target="_blank">https://sccn.ucsd.edu/</a><strong>). The Muse LSL Matlab Tools package is <em>highly</em> untested at this point. If there are issues please email me (ccwillia@uvic.ca), and I will work on fixing them.</strong><br /><br /><u><span><span style="color:rgb(0, 0, 0); font-weight:700">Setup</span></span></u><br /><span><span style="color:rgb(0, 0, 0)">In this, you will be downloading <strong>XCode</strong> and&nbsp;three packages (<strong>Muse LSL Tools</strong>, <strong>Lab Streaming Layer</strong>, <strong>Muse LSL Matlab Tools</strong>) and running various files from these folders. You must put all three folders within the same &lsquo;master&rsquo; folder. The location of this master folder is up to you.</span></span><ul><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">Download and install </span><span style="color:rgb(0, 0, 0); font-weight:700">XCode</span><span style="color:rgb(0, 0, 0)">: <a href="https://idmsa.apple.com/IDMSWebAuth/login?appIdKey=891bd3417a7776362562d2197f89480a8547b108fd934911bcbea0110d07f757&amp;path=%2Fdownload%2F&amp;rv=1" target="_blank">HERE</a></span></span></li><li style="color:rgb(0, 0, 0)">&#8203;<span><span style="color:rgb(0, 0, 0)">Download </span><span style="color:rgb(0, 0, 0); font-weight:700">Muse LSL Tools</span><span style="color:rgb(0, 0, 0)">: <a href="http://kylemathewson.com/eeg/" target="_blank">HERE</a></span></span><ul><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">In matlab, add the main folder (with subfolders) to the path</span></span></li><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">Install Anaconda (</span><span style="color:rgb(0, 0, 0); font-weight:700">Anaconda3-5.0.1-MacOSX-x86_64.pkg</span><span style="color:rgb(0, 0, 0)">)</span></span></li><li style="color:rgb(0, 0, 0)">&#8203;<span><span style="color:rgb(0, 0, 0)">Create two environments using terminal:</span></span><ul><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">pip install matplotlib</span></span></li><li style="color:rgb(0, 0, 0)">&#8203;<span><span style="color:rgb(0, 0, 0)">touch ~/.bash_profile; open ~/.bash_profile</span></span></li><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">conda env create -f </span><span style="color:rgb(0, 0, 0)">/path/to/environment_lsl.yml</span></span></li><li style="color:rgb(0, 0, 0)">&#8203;<span><span style="color:rgb(0, 0, 0)">conda env create -f </span><span style="color:rgb(0, 0, 0)">/path/to/environment_psychopy.yml</span></span><ul><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">Note: change /path/to/ to your directory</span></span></li></ul></li></ul></li></ul></li><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">Download </span><span style="color:rgb(0, 0, 0); font-weight:700">Lab Streaming Layer</span><span style="color:rgb(0, 0, 0)"><a href="https://github.com/sccn/labstreaminglayer" target="_blank">: HERE</a></span></span><ul><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(17, 85, 204)"><a href="https://github.com/sccn/labstreaminglayer" target="_blank">&#8203;</a></span></span><span style="color:rgb(0, 0, 0)">In matlab, add the main folder (without subfolders) and the lsl-matlab folder (with subfolders) to the path.</span></li><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">In terminal navigate to the main folder</span></span><ul><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">&#8203;</span></span><span style="color:rgb(0, 0, 0)">Run: python </span><span style="color:rgb(0, 0, 0); font-weight:700">get_deps.py</span></li></ul></li></ul></li><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">Download </span><span style="color:rgb(0, 0, 0); font-weight:700">Muse LSL Matlab Tools</span><span style="color:rgb(0, 0, 0)"><a href="https://github.com/chadcwilliams/Muse-LSL-Matlab-Tools" target="_blank">: HERE</a></span></span><ul><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">&#8203;</span></span><span style="color:rgb(0, 0, 0)">In matlab, add the main folder (with subfolders) to the path</span></li><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">In matlab, run the </span><span style="color:rgb(0, 0, 0); font-weight:700">LSL_Compile.m</span><span style="color:rgb(0, 0, 0)"> script</span></span></li></ul></li></ul><br /><u><span><span style="color:rgb(0, 0, 0); font-weight:700">Running an Experiment</span></span></u><br /><strong>&#8203;</strong><span><span style="color:rgb(0, 0, 0)">To run an experiment is easy. How to do it is demonstrated in the </span><span style="color:rgb(0, 0, 0); font-weight:700">LSL_Example.m</span><span style="color:rgb(0, 0, 0)"> script. All Matlab scripts in this section can be found in the Muse LSL Matlab Tools package.</span></span><ul><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0); font-weight:700">Connect and record with the Muse</span></span><ul><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0); font-weight:700">&#8203;</span></span><span style="color:rgb(0, 0, 0)">You will initiate a connection to the Muse, do an impedance check, and begin recording all with the matlab function </span><span style="color:rgb(0, 0, 0); font-weight:700">LSL_Muse_Initiation.m</span></li><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)"><strong>Connect to the Muse:</strong> this first initiates an applescript that automatically runs the LSL_Connect.py script from the Muse LSL Tools and will begin a marker data stream within matlab.</span></span></li><li><strong>View your data (impedance check)</strong>: this then initiates the next portion of the applescript which automatically runs the LSL_Viewer-V2.py script from the Muse LSL Tools.</li><li><strong>Begin recording</strong>: finally, another applescript will automatically run the LSL_Record.py script from the Muse LSL Tools, where an indefinite recording will begin.</li></ul></li><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0); font-weight:700">Sending markers</span></span><ul><li style="color:rgb(0, 0, 0)"><span style="color:rgb(0, 0, 0)">Within your script simply write: </span><span style="color:rgb(0, 0, 0); font-weight:700">outlet.push_sample({'1'},0);</span><ul><li style="color:rgb(0, 0, 0)"><span style="color:rgb(0, 0, 0)">Change the string &lsquo;1&rsquo; to whichever marker you like.</span></li></ul></li></ul></li><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0); font-weight:700">Shutting down</span></span><ul><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0); font-weight:700">&#8203;</span></span><span style="color:rgb(0, 0, 0)">The function </span><span style="color:rgb(0, 0, 0); font-weight:700">LSL_Shutdown.m</span><span style="color:rgb(0, 0, 0)"> should be placed at the end of your script. This simply ends the LSL_Record.py script, thus saving your data. You will want to manually close all terminal windows (thus, breaking the Muse connection) as well.</span></li></ul></li><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0); font-weight:700">Data structure</span></span><ul><li style="color:rgb(0, 0, 0)"><span style="color:rgb(0, 0, 0)">The data is saved&nbsp;as a CSV file.</span></li><li style="color:rgb(0, 0, 0)"><span style="color:rgb(0, 0, 0)">Each column is an input and time spans across the rows.</span></li><li style="color:rgb(0, 0, 0)"><span style="color:rgb(0, 0, 0)">The columns (in order) are timestamps, TP9, AF7, AF8, TP10, Right Aux, Markers</span>&#8203;</li></ul></li></ul> <strong>&#8203;<br /><u>&#8203;</u></strong><u><span><span style="color:rgb(0, 0, 0); font-weight:700">Converting data to Brain Vision Analyzer format</span></span></u><br /><span><span style="color:rgb(0, 0, 0); font-weight:700">&#8203;THIS IS NOT YET AVAILABLE</span></span><ul><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">The data is saved in .csv file is easily manageable. </span></span></li><li style="color:rgb(0, 0, 0)"><span><span style="color:rgb(0, 0, 0)">In the Muse LSL Matlab Tools package, there is a </span><span style="color:rgb(0, 0, 0); font-weight:700">CONVERT_MUSELSL_TO_BV</span><span style="color:rgb(0, 0, 0)"> script which can be used to convert code into a Brain Vision Analyzer format. </span></span></li></ul></div>
